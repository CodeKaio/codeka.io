[tools]
hugo-extended = "0.152"

[env]
HUGO_OPTIONS = "--printI18nWarnings --printPathWarnings --cleanDestinationDir --logLevel debug"
PLAUSIBLE_API_KEY = { age = { value = "KLUv/QBYhRwASkEsDj0AUTz8dxbdSE0oKEI1+KX/3awxgu1WPNUUxMgMJrCATEIALMYcPmEhYWCDCCD6shi6hWGbr7nNwfd6jwgiywDLAM4AFabCeS0nv7yJvz2Kku/pOm2RBHXJm1tsxDPxOl80qsnBKOs34rSc9PwQg5lIkCzTKzxHnYQNXXp92vGyE1ZKsRbhHbC+MVHqZCwU3f27zJDURqtoQ2cuX9FXTPZqLSLTG8kk+7Ktse+3T/6Xyyq8htt9t5XYmo0GP6mjbimPAaHy+1Kip4ecf3rxEuR98NxxUjTKVddFdK3tbQ2P4XXqaS/YqELlk3v8fu59JR9ltbd9tLsOkff90QGRqp6KddzBjc8h0K+/NwyB4zZULXlvlB7Bm10zGTaZLDft837pibqkiUPWdGpnPtaZJ9p48T9yQeMYh6GUktu3xtyoXj2x1MjNyI/8uPD0NJkb9T5lK0kfiSX8Da0MFKI36xuRaf9pNzAambHI3J1nr1fSnv34tr7Ma/P98vz/+0NltgTzcptne/OMJVmbObYGk/SgLTttz99RMy2XgVUcE1lM/b87w0BNue0iz9r48TnRVgXrTlTXxPa3Yc9LqvS7r1lsltR4b/qhOp3k1T7qFdbfh4rA1bQr+ab1A3V4m6Hoez3lM4MwOEXSQ/mGugoeVVYBnhvcD3hvYT2GaJaEBxGORwdEirO1mieRiS9a3htZwYvyXDZodr6u5XZmy+MmsqxexazlTrpA6EptHElbXrZaHnEwvbl0H0daMh+UufGEaZ7pifMRdZnIr4t/lqrEdDYRHTrhTcz9Esn20o5dj1+N2dQNh8PpeDG09g1kq38NSj0WzrwjlWEjzGEhnLmqu+N79YJ94Mgl70Lfl64UptEJNflWUvtLS6lhTzY8e7OdOZyHQb/yw9ejLChMCORxBBMeZoCWFyo6GHCQYatvrLggYrJRgOYAoQSGEDFIqFUAFwhYDIAoGNCAI6SChogNoxUyRLxgkEIXYOFBjRYFWqw68TJAsUBfQXzweA50TGA5OCQA8CLnwBihIYUl+WZEF0U+IbjpKX1nQsuQvmgKeL0U1sO9kPOu0Ndn30rDzAMCgUjbKaVWurP/vH8T/GK5kSyuKpkTrGeuZHmKjLKUOj1BNCZd0VqhlWrlKerX+h+CLtN1MatPKkU/v1v3U682m40uLk4oBWNhneZu01Vql/7HJ5FV1mdGncV8ogcA", format = "zstd" } }

[tasks]

[tasks.fetch-views-data]
description = 'Fetch data from plausible'
dir = "scripts"
tools.go = "1.21"
run = "go run plausible_fetch.go -site codeka.io -range all -out ../data/plausible-stats/visits.json"

[tasks.build]
description = "Build le site avec Hugo"
depends = ['fetch-views-data']
run = "hugo build $HUGO_OPTIONS"

[tasks.serve]
description = "Lance le serveur de développement Hugo"
depends = ['fetch-views-data']
run = "hugo server --openBrowser $HUGO_OPTIONS"

[tasks.draft]
description = "Serve Hugo en incluant les brouillons et futures publications"
depends = ['fetch-views-data']
run = "hugo server --openBrowser $HUGO_OPTIONS --buildDrafts --buildFuture"

[tasks.nbsp]
description = "Insère des espaces insécables avant ;?:! dans les posts"
run = '''
    sed -i '/^---$/,/^---$/b;s/ \([;?:!]\)/\ \1/g' content/posts/**/*.md
'''

[tasks."new-tech-watch-post"]
description = "Crée un nouveau post de veille"
usage = '''
arg "<date>" help="Date de publication du post"
'''
run = "hugo new content posts/${usage_date}-mi-veille -k veille"

[tasks."clever:preview"]
description = "Déploie une preview Clever Cloud et ouvre l'URL"
depends = ['fetch-views-data']
run = "clever deploy --alias preview --force && clever open --alias preview"

[tasks."clever:deploy"]
description = "Déploie sur l'alias Clever Cloud principal"
depends = ['fetch-views-data']
run = "clever deploy --alias codeka.io"
